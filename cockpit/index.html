<!DOCTYPE html>
<html>

<head>
    <!--
    Haas Appliance - Cockpit Firewall Control Page

    This page provides a simple UI for:
      - Simulating firewall changes (dry-run)
      - Comparing current vs planned rules
      - Rolling back to a previous CSV backup

    It loads haas-firewall.js for logic and uses Cockpit's JS APIs.
  -->
    <meta charset="utf-8">
    <title>Haas Firewall Control</title>

    <!-- REQUIRED for Cockpit to inject cockpit.js -->
    <base href="">

    <!-- Cockpit core JS API (required for cockpit.spawn, cockpit.file, etc.) -->
    <script src="resource://cockpit/cockpit.js"></script>

    <!-- Cockpit Web Components polyfills -->
    <script src="resource://cockpit/wc/polyfills.js"></script>

    <script src="haas-firewall.js"></script>
    <link rel="stylesheet"
        href="resource://cockpit/wc/styles.css">
    <style>
        body {
            margin: 16px;
            font-family: sans-serif;
        }

        h1 {
            margin-bottom: 0.5rem;
        }

        .section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .button-row {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        button {
            padding: 0.4rem 0.9rem;
            cursor: pointer;
        }

        #output {
            white-space: pre-wrap;
            background: #111;
            color: #eee;
            padding: 0.75rem;
            border-radius: 4px;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }

        label {
            font-weight: bold;
        }

        input[type="text"] {
            width: 100%;
            max-width: 400px;
            padding: 0.3rem;
            margin-top: 0.25rem;
        }
    </style>
</head>

<body>
    <h1>Haas Firewall Control</h1>
    <p>
        Use this page to simulate firewall changes, compare rules, and rollback CSV backups.
    </p>

    <div class="section">
        <h2>Simulate / Compare</h2>
        <p>
            These operations do not make persistent changes to the firewall.
        </p>
        <div class="button-row">
            <button id="btn-dry-run">Simulate Firewall Update (Dry-Run)</button>
            <button id="btn-compare">Compare Current vs Planned Rules</button>
            <button id="btn-show-rules">Show Current UFW Rules</button>
        </div>
    </div>

    <div class="section">
        <h2>Rollback CSV Backup</h2>
        <p>
            Restore a previous CSV backup from:
            <code>/home/mhubbard/Haas_Data_collect/backups</code>
        </p>
        <label for="backup-name">Backup filename (e.g. users_2025-01-13_12-00-00.csv)</label>
        <input type="text"
            id="backup-name"
            placeholder="Enter backup filename">
        <div class="button-row"
            style="margin-top: 0.5rem;">
            <button id="btn-rollback">Rollback CSV</button>
        </div>
    </div>

    <div class="section">
        <h2>Output</h2>
        <div id="output">Output will appear here...</div>
    </div>
</body>

</html>
